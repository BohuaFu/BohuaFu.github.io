<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Dart," />










<meta name="description" content="Dart标准库与其他语言一样，Dart 自带处理常见任务的库，即标准库。Dart 的标准库由核心库dart:core及其他17个库组成。 Dart 程序依赖于 库. 这里为您提供了几个常用的库。 例如，dart：core 提供了一组小而重要的内置功能， 例如数字，集合和字符串处理。 另一个重要的库 dart：async，它支持进行异步编程的类 像 Future 和 Stream 。 您可以通过 p">
<meta property="og:type" content="article">
<meta property="og:title" content="Dart 標準庫">
<meta property="og:url" content="https://bohuafu.github.io/2020/04/13/dart/d-20200413-0201/index.html">
<meta property="og:site_name" content="BH, 我的部落格">
<meta property="og:description" content="Dart标准库与其他语言一样，Dart 自带处理常见任务的库，即标准库。Dart 的标准库由核心库dart:core及其他17个库组成。 Dart 程序依赖于 库. 这里为您提供了几个常用的库。 例如，dart：core 提供了一组小而重要的内置功能， 例如数字，集合和字符串处理。 另一个重要的库 dart：async，它支持进行异步编程的类 像 Future 和 Stream 。 您可以通过 p">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2020-04-12T22:02:01.000Z">
<meta property="article:modified_time" content="2020-04-17T05:16:23.007Z">
<meta property="article:author" content="Bohua Fu">
<meta property="article:tag" content="Dart">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bohuafu.github.io/2020/04/13/dart/d-20200413-0201/"/>





  <title>Dart 標準庫 | BH, 我的部落格</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-TW">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BH, 我的部落格</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">學習・分享・改變</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bohuafu.github.io/2020/04/13/dart/d-20200413-0201/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bohua Fu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://github.com/BohuaFu/AssetsBH/blob/master/bh/avater/bh_avatar_001.jpg?raw=true">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BH, 我的部落格">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Dart 標準庫</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-04-13T06:02:01+08:00">
                2020-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Dart标准库"><a href="#Dart标准库" class="headerlink" title="Dart标准库"></a>Dart标准库</h1><p>与其他语言一样，Dart 自带处理常见任务的库，即标准库。Dart 的标准库由核心库<code>dart:core</code>及其他17个库组成。</p>
<p>Dart 程序依赖于 <em>库</em>. 这里为您提供了几个常用的库。 例如，<code>dart：core</code> 提供了一组小而重要的内置功能， 例如数字，集合和字符串处理。 另一个重要的库 <code>dart：async</code>，它支持进行异步编程的类 像 Future 和 Stream 。 您可以通过 <em>packages</em> 来导入获取其他库。</p>
<a id="more"></a>

<p><code>dart:core</code>是 Dart 的核心库，其中包含最基础最常用的类型，如：int，List 等。<code>dart:core</code>会隐含导入到代码中，无需使用<code>import</code>导入（显式导入<code>dart:core</code>反而会报错）。</p>
<p>除核心库外的其他库，按照适用平台，划分为三类:</p>
<ol>
<li>通用库，可适用于服务端和Web端；</li>
<li>仅适用于服务端(VM)</li>
<li>仅适用于Web端</li>
</ol>
<table>
<thead>
<tr>
<th>库名</th>
<th>适用平台</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>dart:async</td>
<td>通用</td>
<td>异步编程库，包含<code>Future</code>、<code>Stream</code>等常用异步编程类型</td>
</tr>
<tr>
<td>dart:collection</td>
<td>通用</td>
<td>集合支持/工具库，对<code>dart:core</code>中的集合类型（<code>List</code>、<code>Map</code>等）提供补充</td>
</tr>
<tr>
<td>dart:convert</td>
<td>通用</td>
<td>转换库，用于对各种数据格式的编码/解码，如：<code>json</code>和<code>utf8</code></td>
</tr>
<tr>
<td>dart:developer</td>
<td>通用</td>
<td>开发者库，提供开发者工具，如：<code>debugger</code>和<code>inspector</code></td>
</tr>
<tr>
<td>dart:math</td>
<td>通用</td>
<td>数学库，提供各种数学运算相关函数</td>
</tr>
<tr>
<td>dart:typed_data</td>
<td>通用</td>
<td>高效、固定长度的列表类型库</td>
</tr>
<tr>
<td>dart:io</td>
<td>VM</td>
<td>io库，提供文件、Socket等常见io操作类</td>
</tr>
<tr>
<td>dart:isolate</td>
<td>VM</td>
<td>并发编程支持库</td>
</tr>
<tr>
<td>dart:mirrors</td>
<td>VM</td>
<td>反射库（API不稳定）</td>
</tr>
<tr>
<td>dart:html</td>
<td>Web</td>
<td>html库，提供对html元素和dom的操作等</td>
</tr>
<tr>
<td>dart:indexed_db</td>
<td>Web</td>
<td>Web端indexed_db数据库支持库</td>
</tr>
<tr>
<td>dart:js</td>
<td>Web</td>
<td>JavaScript库，支持对JavaScript对象/方法的访问</td>
</tr>
<tr>
<td>dart:js_util</td>
<td>Web</td>
<td>JavaScript交互工具库</td>
</tr>
<tr>
<td>dart:svg</td>
<td>Web</td>
<td>svg矢量图形支持库</td>
</tr>
<tr>
<td>dart:web_audio</td>
<td>Web</td>
<td>Web端音频处理库</td>
</tr>
<tr>
<td>dart:web_gl</td>
<td>Web</td>
<td>Web端3D编程支持库</td>
</tr>
<tr>
<td>dart:web_sql</td>
<td>Web</td>
<td>Web端SQL支持库（标准过时，推荐使用dart:indexed_db代替）</td>
</tr>
</tbody></table>
<h1 id="Dart-库概览"><a href="#Dart-库概览" class="headerlink" title="Dart 库概览"></a>Dart 库概览</h1><p>本章将介绍以下库的主要功能及使用方式， 所有Dart平台中都包含这些库：</p>
<ul>
<li><p><a href="https://www.dartcn.com/guides/libraries/library-tour#dartcore---numbers-collections-strings-and-more" target="_blank" rel="noopener">dart:core</a></p>
<p>内置类型，集合和其他核心功能。 该库会被自动导入到所有的 Dart 程序。</p>
</li>
<li><p><a href="https://www.dartcn.com/guides/libraries/library-tour#dartasync---asynchronous-programming" target="_blank" rel="noopener">dart:async</a></p>
<p>支持异步编程，包括Future和Stream等类。</p>
</li>
<li><p><a href="https://www.dartcn.com/guides/libraries/library-tour#dartmath---math-and-random" target="_blank" rel="noopener">dart:math</a></p>
<p>数学常数和函数，以及随机数生成器。</p>
</li>
<li><p><a href="https://www.dartcn.com/guides/libraries/library-tour#dartconvert---decoding-and-encoding-json-utf-8-and-more" target="_blank" rel="noopener">dart:convert</a></p>
<p>用于在不同数据表示之间进行转换的编码器和解码器，包括 JSON 和 UTF-8 。</p>
</li>
</ul>
<p>本章只是一个概述； 只涵盖了几个 dart:* 库， 不包括第三方库。 特定平台库 dart:io 和 dart:html 的介绍，详见 <a href="https://www.dartcn.com/server/io-library-tour" target="_blank" rel="noopener">dart:io tour</a> 和 <a href="https://webdev.dartlang.org/guides/html-library-tour" target="_blank" rel="noopener">dart:html tour</a> 。</p>
<p>更多库信息可以在 [pub.dartlang.org][pub.dartlang.org] 和 <a href="https://webdev.dartlang.org/guides/web-programming" target="_blank" rel="noopener">Dart web developer library guide.</a> 查找。 所有 dart:* 库的 API 文档可以在 <a href="https://api.dartlang.org/stable" target="_blank" rel="noopener">Dart API reference</a> 查找， 如果使用的是 Flutter 可以在 [Flutter API reference.][docs.flutter.io] 查找。</p>
<p><strong>DartPad tip：</strong> 可以通过将该页中的代码拷贝到 <a href="https://dartpad.cn/" target="_blank" rel="noopener">DartPad</a> 中进行演示。</p>
<h2 id="dart-core-数字，集合，字符串等"><a href="#dart-core-数字，集合，字符串等" class="headerlink" title="dart:core - 数字，集合，字符串等"></a>dart:core - 数字，集合，字符串等</h2><p>dart:core 库 (<a href="https://api.dartlang.org/stable/dart-core/dart-core-library.html" target="_blank" rel="noopener">API reference</a>) 提供了一个少量但是重要的内置功能集合。 该库会被自动导入每个 Dart 程序。</p>
<h3 id="控制台打印"><a href="#控制台打印" class="headerlink" title="控制台打印"></a>控制台打印</h3><p>顶级 <code>print()</code> 方法接受一个参数 任意对象） 并输出显示这个对象的字符串值(由 <code>toString()</code> 返回) 到控制台。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(anObject);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'I drink <span class="subst">$tea</span>.'</span>);</span><br></pre></td></tr></table></figure>

<p>有关基本字符串和 <code>toString()</code> 的更多信息，参考 <a href="https://www.dartcn.com/guides/language/language-tour#strings" target="_blank" rel="noopener">Strings</a> in the language tour.</p>
<h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>dart:core 库定义了 num ，int 以及 double 类， 这些类拥有一定的工具方法来处理数字。</p>
<p>使用 int 和 double 的 <code>parse()</code> 方法将字符串转换为整型或双浮点型对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">int</span>.parse(<span class="string">'42'</span>) == <span class="number">42</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">int</span>.parse(<span class="string">'0x42'</span>) == <span class="number">66</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">double</span>.parse(<span class="string">'0.50'</span>) == <span class="number">0.5</span>);</span><br></pre></td></tr></table></figure>

<p>或者使用 num 的 parse() 方法，该方法可能会创建一个整型，否则为浮点型对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">num</span>.parse(<span class="string">'42'</span>) <span class="keyword">is</span> <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">num</span>.parse(<span class="string">'0x42'</span>) <span class="keyword">is</span> <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">num</span>.parse(<span class="string">'0.50'</span>) <span class="keyword">is</span> <span class="built_in">double</span>);</span><br></pre></td></tr></table></figure>

<p>通过添加 <code>radix</code> 参数，指定整数的进制基数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">int</span>.parse(<span class="string">'42'</span>, radix: <span class="number">16</span>) == <span class="number">66</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>toString()</code> 方法将整型或双精度浮点类型转换为字符串类型。 使用 <a href="https://api.dartlang.org/stable/dart-core/num/toStringAsFixed.html" target="_blank" rel="noopener">toStringAsFixed().</a> 指定小数点右边的位数， 使用 <a href="https://api.dartlang.org/stable/dart-core/num/toStringAsPrecision.html" target="_blank" rel="noopener">toStringAsPrecision():</a> 指定字符串中的有效数字的位数。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 整型转换为字符串类型。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="number">42.</span>toString() == <span class="string">'42'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双浮点型转换为字符串类型。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="number">123.456</span>.toString() == <span class="string">'123.456'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定小数点后的位数。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="number">123.456</span>.toStringAsFixed(<span class="number">2</span>) == <span class="string">'123.46'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定有效数字的位数。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="number">123.456</span>.toStringAsPrecision(<span class="number">2</span>) == <span class="string">'1.2e+2'</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">double</span>.parse(<span class="string">'1.2e+2'</span>) == <span class="number">120.0</span>);</span><br></pre></td></tr></table></figure>

<p>更多详情， 参考 <a href="https://api.dartlang.org/stable/dart-core/int-class.html" target="_blank" rel="noopener">int，</a> <a href="https://api.dartlang.org/stable/dart-core/double-class.html" target="_blank" rel="noopener">double，</a> 和 <a href="https://api.dartlang.org/stable/dart-core/num-class.html" target="_blank" rel="noopener">num</a> 的相关 API 文档。 也可参考 <a href="https://www.dartcn.com/guides/libraries/library-tour#dartmath---math-and-random" target="_blank" rel="noopener">dart:math section</a>。</p>
<h3 id="字符和正则表达式"><a href="#字符和正则表达式" class="headerlink" title="字符和正则表达式"></a>字符和正则表达式</h3><p>在 Dart 中一个字符串是一个固定不变的 UTF-16 编码单元序列。 语言概览中有更多关于 <a href="https://www.dartcn.com/guides/language/language-tour#strings" target="_blank" rel="noopener">strings</a> 的内容。 使用正则表达式 (RegExp 对象) 可以在字符串内搜索和替换部分字符串。</p>
<p>String 定义了例如 <code>split()</code>， <code>contains()</code>， <code>startsWith()</code>， <code>endsWith()</code> 等方法。</p>
<h4 id="在字符串中搜索"><a href="#在字符串中搜索" class="headerlink" title="在字符串中搜索"></a>在字符串中搜索</h4><p>可以在字符串内查找特定字符串的位置， 以及检查字符串是否以特定字符串作为开头或结尾。例如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查一个字符串是否包含另一个字符串。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>.contains(<span class="string">'odd'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个字符串是否以另一个字符串为开头?</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>.startsWith(<span class="string">'Never'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个字符串是否以另一个字符串为结尾?</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>.endsWith(<span class="string">'even'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找一个字符串在另一个字符串中的位置。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>.indexOf(<span class="string">'odd'</span>) == <span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<h4 id="从字符串中提取数据"><a href="#从字符串中提取数据" class="headerlink" title="从字符串中提取数据"></a>从字符串中提取数据</h4><p>可以获取字符串中的单个字符，将其作为字符串或者整数。 确切地说，实际上获取的是单独的UTF-16编码单元; 诸如高音谱号符号 (‘\u{1D11E}’) 之类的高编号字符分别为两个编码单元。</p>
<p>你也可以获取字符串中的子字符串或者将一个字符串分割为子字符串列表：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抓取一个子字符串。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>.substring(<span class="number">6</span>, <span class="number">9</span>) == <span class="string">'odd'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用字符串模式分割字符串。</span></span><br><span class="line"><span class="keyword">var</span> parts = <span class="string">'structured web apps'</span>.split(<span class="string">' '</span>);</span><br><span class="line"><span class="keyword">assert</span>(parts.length == <span class="number">3</span>);</span><br><span class="line"><span class="keyword">assert</span>(parts[<span class="number">0</span>] == <span class="string">'structured'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过下标获取 UTF-16 编码单元（编码单元作为字符串）。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'Never odd or even'</span>[<span class="number">0</span>] == <span class="string">'N'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 split() 传入一个空字符串参数，</span></span><br><span class="line"><span class="comment">// 得到一个所有字符的 list 集合；</span></span><br><span class="line"><span class="comment">// 有助于字符迭代。</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> char <span class="keyword">in</span> <span class="string">'hello'</span>.split(<span class="string">''</span>)) &#123;</span><br><span class="line">  <span class="built_in">print</span>(char);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取一个字符串的所有 UTF-16 编码单元。</span></span><br><span class="line"><span class="keyword">var</span> codeUnitList =</span><br><span class="line">    <span class="string">'Never odd or even'</span>.codeUnits.toList();</span><br><span class="line"><span class="keyword">assert</span>(codeUnitList[<span class="number">0</span>] == <span class="number">78</span>);</span><br></pre></td></tr></table></figure>

<h4 id="首字母大小写转换"><a href="#首字母大小写转换" class="headerlink" title="首字母大小写转换"></a>首字母大小写转换</h4><p>可以轻松的对字符串的首字母大小写进行转换：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转换为首字母大写。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'structured web apps'</span>.toUpperCase() ==</span><br><span class="line">    <span class="string">'STRUCTURED WEB APPS'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为首字母小写。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'STRUCTURED WEB APPS'</span>.toLowerCase() ==</span><br><span class="line">    <span class="string">'structured web apps'</span>);</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong> 这些方法不是在所有语言上都有效的。例如， 土耳其字母表的无点 <em>I</em> 转换是不正确的。</p>
<h4 id="Trimming-和空字符串"><a href="#Trimming-和空字符串" class="headerlink" title="Trimming 和空字符串"></a>Trimming 和空字符串</h4><p>使用 <code>trim()</code> 移除首尾空格。 使用 <code>isEmpty</code> 检查一个字符串是否为空（长度为0）。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Trim a string.</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'  hello  '</span>.trim() == <span class="string">'hello'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查字符串是否为空。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">''</span>.isEmpty);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空格字符串不是空字符串。</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">'  '</span>.isNotEmpty);</span><br></pre></td></tr></table></figure>

<h4 id="替换部分字符串"><a href="#替换部分字符串" class="headerlink" title="替换部分字符串"></a>替换部分字符串</h4><p>字符串是不可变的对象，也就是说字符串可以创建但是不能被修改。 如果仔细阅读了 <a href="https://api.dartlang.org/stable/dart-core/String-class.html" target="_blank" rel="noopener">String API docs,</a> 你会注意到，没有一个方法实际的改变了字符串的状态。 例如，方法 <code>replaceAll()</code> 返回一个新字符串， 并没有改变原始字符串：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> greetingTemplate = <span class="string">'Hello, NAME!'</span>;</span><br><span class="line"><span class="keyword">var</span> greeting =</span><br><span class="line">    greetingTemplate.replaceAll(<span class="built_in">RegExp</span>(<span class="string">'NAME'</span>), <span class="string">'Bob'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// greetingTemplate 没有改变。</span></span><br><span class="line"><span class="keyword">assert</span>(greeting != greetingTemplate);</span><br></pre></td></tr></table></figure>

<h4 id="构建一个字符串"><a href="#构建一个字符串" class="headerlink" title="构建一个字符串"></a>构建一个字符串</h4><p>要以代码方式生成字符串，可以使用 StringBuffer 。 在调用 <code>toString()</code> 之前， StringBuffer 不会生成新字符串对象。 <code>writeAll()</code> 的第二个参数为可选参数，用来指定分隔符， 本例中使用空格作为分隔符。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sb = <span class="built_in">StringBuffer</span>();</span><br><span class="line">sb</span><br><span class="line">  ..write(<span class="string">'Use a StringBuffer for '</span>)</span><br><span class="line">  ..writeAll([<span class="string">'efficient'</span>, <span class="string">'string'</span>, <span class="string">'creation'</span>], <span class="string">' '</span>)</span><br><span class="line">  ..write(<span class="string">'.'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fullString = sb.toString();</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(fullString ==</span><br><span class="line">    <span class="string">'Use a StringBuffer for efficient string creation.'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><p>RegExp类提供与JavaScript正则表达式相同的功能。 使用正则表达式可以对字符串进行高效搜索和模式匹配。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面正则表达式用于匹配一个或多个数字。</span></span><br><span class="line"><span class="keyword">var</span> numbers = <span class="built_in">RegExp</span>(<span class="string">r'\d+'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allCharacters = <span class="string">'llamas live fifteen to twenty years'</span>;</span><br><span class="line"><span class="keyword">var</span> someDigits = <span class="string">'llamas live 15 to 20 years'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// contains() 能够使用正则表达式。</span></span><br><span class="line"><span class="keyword">assert</span>(!allCharacters.contains(numbers));</span><br><span class="line"><span class="keyword">assert</span>(someDigits.contains(numbers));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 替换所有匹配对象为另一个字符串。</span></span><br><span class="line"><span class="keyword">var</span> exedOut = someDigits.replaceAll(numbers, <span class="string">'XX'</span>);</span><br><span class="line"><span class="keyword">assert</span>(exedOut == <span class="string">'llamas live XX to XX years'</span>);</span><br></pre></td></tr></table></figure>

<p>你也可以直接使用RegExp类。 Match 类提供对正则表达式匹配对象的访问。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = <span class="built_in">RegExp</span>(<span class="string">r'\d+'</span>);</span><br><span class="line"><span class="keyword">var</span> someDigits = <span class="string">'llamas live 15 to 20 years'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查正则表达式是否在字符串中匹配到对象。</span></span><br><span class="line"><span class="keyword">assert</span>(numbers.hasMatch(someDigits));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代所有匹配对象</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> match <span class="keyword">in</span> numbers.allMatches(someDigits)) &#123;</span><br><span class="line">  <span class="built_in">print</span>(match.group(<span class="number">0</span>)); <span class="comment">// 15, then 20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h4><p>有关完整的方法列表， 请参考 <a href="https://api.dartlang.org/stable/dart-core/String-class.html" target="_blank" rel="noopener">String API docs</a>。 另请参考 <a href="https://api.dartlang.org/stable/dart-core/StringBuffer-class.html" target="_blank" rel="noopener">StringBuffer，</a> <a href="https://api.dartlang.org/stable/dart-core/Pattern-class.html" target="_blank" rel="noopener">Pattern，</a> <a href="https://api.dartlang.org/stable/dart-core/RegExp-class.html" target="_blank" rel="noopener">RegExp，</a> 和 <a href="https://api.dartlang.org/stable/dart-core/Match-class.html" target="_blank" rel="noopener">Match</a> 的 API 文档。</p>
<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>Dart 附带了核心集合 API ，其中包括 list ，set 和 map 类。</p>
<h4 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h4><p>如语言概览中介绍，<a href="https://www.dartcn.com/guides/libraries/library-tour#lists" target="_blank" rel="noopener">lists</a> 可以通过字面量来创建和初始化。 另外，也可以使用 List 的构造函数。 List 类还定义了若干方法，用于向列表添加或删除项目。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 List 构造函数。</span></span><br><span class="line"><span class="keyword">var</span> vegetables = <span class="built_in">List</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者仅使用一个 list 字面量。</span></span><br><span class="line"><span class="keyword">var</span> fruits = [<span class="string">'apples'</span>, <span class="string">'oranges'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个元素到 list 对象。</span></span><br><span class="line">fruits.add(<span class="string">'kiwis'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加多个元素到 list 对象。</span></span><br><span class="line">fruits.addAll([<span class="string">'grapes'</span>, <span class="string">'bananas'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 list 长度。</span></span><br><span class="line"><span class="keyword">assert</span>(fruits.length == <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除一个元素到 list 对象。</span></span><br><span class="line"><span class="keyword">var</span> appleIndex = fruits.indexOf(<span class="string">'apples'</span>);</span><br><span class="line">fruits.removeAt(appleIndex);</span><br><span class="line"><span class="keyword">assert</span>(fruits.length == <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除多个元素到 list 对象。</span></span><br><span class="line">fruits.clear();</span><br><span class="line"><span class="keyword">assert</span>(fruits.length == <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>indexOf()</code> 方法查找一个对象在 list 中的下标值。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fruits = [<span class="string">'apples'</span>, <span class="string">'oranges'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用下标访问 list 中的元素</span></span><br><span class="line"><span class="keyword">assert</span>(fruits[<span class="number">0</span>] == <span class="string">'apples'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找一个元素在 list 中的下标。</span></span><br><span class="line"><span class="keyword">assert</span>(fruits.indexOf(<span class="string">'apples'</span>) == <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>sort()</code> 方法排序一个 list 。 你可以提供一个排序函数用于比较两个对象。 比较函数在 <em>小于</em> 时返回 \ &lt;0，<em>相等</em> 时返回 0，<em>bigger</em> 时返回 &gt; 0 。 下面示例中使用 <code>compareTo()</code> 函数， 该函数在 <a href="https://api.dartlang.org/stable/dart-core/Comparable-class.html" target="_blank" rel="noopener">Comparable</a> 中定义， 并被 String 类实现。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fruits = [<span class="string">'bananas'</span>, <span class="string">'apples'</span>, <span class="string">'oranges'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序一个 list 。</span></span><br><span class="line">fruits.sort((a, b) =&gt; a.compareTo(b));</span><br><span class="line"><span class="keyword">assert</span>(fruits[<span class="number">0</span>] == <span class="string">'apples'</span>);</span><br></pre></td></tr></table></figure>

<p>list 是参数化类型， 因此可以指定 list 应该包含的元素类型：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个 list 只能包含字符串类型。</span></span><br><span class="line"><span class="keyword">var</span> fruits = <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;();</span><br><span class="line"></span><br><span class="line">fruits.add(<span class="string">'apples'</span>);</span><br><span class="line"><span class="keyword">var</span> fruit = fruits[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">assert</span>(fruit <span class="keyword">is</span> <span class="built_in">String</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 产生静态分析警告，num 不是字符串类型。</span></span><br><span class="line">fruits.add(<span class="number">5</span>); <span class="comment">// BAD: Throws exception in checked mode.</span></span><br><span class="line">fruits.add(<span class="number">5</span>); <span class="comment">// Error: 'int' can't be assigned to 'String'</span></span><br></pre></td></tr></table></figure>

<p>全部的方法介绍 ，请参考 <a href="https://api.dartlang.org/stable/dart-core/List-class.html" target="_blank" rel="noopener">List API docs</a> 。</p>
<h4 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h4><p>在 Dart 中，set 是一个无序的，元素唯一的集合。 因为一个 set 是无序的，所以无法通过下标（位置）获取 set 中的元素。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ingredients = <span class="built_in">Set</span>();</span><br><span class="line">ingredients.addAll([<span class="string">'gold'</span>, <span class="string">'titanium'</span>, <span class="string">'xenon'</span>]);</span><br><span class="line"><span class="keyword">assert</span>(ingredients.length == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加一个重复的元素是无效的。</span></span><br><span class="line">ingredients.add(<span class="string">'gold'</span>);</span><br><span class="line"><span class="keyword">assert</span>(ingredients.length == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从 set 中移除一个元素。</span></span><br><span class="line">ingredients.remove(<span class="string">'gold'</span>);</span><br><span class="line"><span class="keyword">assert</span>(ingredients.length == <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>contains()</code> 和 <code>containsAll()</code> 来检查一个或多个元素是否在 set 中。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ingredients = <span class="built_in">Set</span>();</span><br><span class="line">ingredients.addAll([<span class="string">'gold'</span>, <span class="string">'titanium'</span>, <span class="string">'xenon'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查一个元素是否在该 set 中。</span></span><br><span class="line"><span class="keyword">assert</span>(ingredients.contains(<span class="string">'titanium'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查多个元素是否在该 set 中。</span></span><br><span class="line"><span class="keyword">assert</span>(ingredients.containsAll([<span class="string">'titanium'</span>, <span class="string">'xenon'</span>]));</span><br></pre></td></tr></table></figure>

<p>交集是另外两个 set 中的公共元素组成的 set 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ingredients = <span class="built_in">Set</span>();</span><br><span class="line">ingredients.addAll([<span class="string">'gold'</span>, <span class="string">'titanium'</span>, <span class="string">'xenon'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建两个 set 的交集。</span></span><br><span class="line"><span class="keyword">var</span> nobleGases = <span class="built_in">Set</span>.from([<span class="string">'xenon'</span>, <span class="string">'argon'</span>]);</span><br><span class="line"><span class="keyword">var</span> intersection = ingredients.intersection(nobleGases);</span><br><span class="line"><span class="keyword">assert</span>(intersection.length == <span class="number">1</span>);</span><br><span class="line"><span class="keyword">assert</span>(intersection.contains(<span class="string">'xenon'</span>));</span><br></pre></td></tr></table></figure>

<p>全部的方法介绍 ，请参考 <a href="https://api.dartlang.org/stable/dart-core/Set-class.html" target="_blank" rel="noopener">Set API docs</a> 。</p>
<h4 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h4><p>map 是一个无序的 key-value （键值对）集合，就是大家熟知的 <em>dictionary</em> 或者 <em>hash</em>。 map 将 kay 与 value 关联，以便于检索。和 JavaScript 不同，Dart 对象不是 map 。</p>
<p>声明 map 可以使用简洁的字面量语法，也可以使用传统构造函数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// map 通常使用字符串作为 key。</span></span><br><span class="line"><span class="keyword">var</span> hawaiianBeaches = &#123;</span><br><span class="line">  <span class="string">'Oahu'</span>: [<span class="string">'Waikiki'</span>, <span class="string">'Kailua'</span>, <span class="string">'Waimanalo'</span>],</span><br><span class="line">  <span class="string">'Big Island'</span>: [<span class="string">'Wailea Bay'</span>, <span class="string">'Pololu Beach'</span>],</span><br><span class="line">  <span class="string">'Kauai'</span>: [<span class="string">'Hanalei'</span>, <span class="string">'Poipu'</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// map 可以通过构造函数构建。</span></span><br><span class="line"><span class="keyword">var</span> searchTerms = <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// map 是参数化类型；</span></span><br><span class="line"><span class="comment">// 可以指定一个 map 中 key 和 value 的类型。</span></span><br><span class="line"><span class="keyword">var</span> nobleGases = <span class="built_in">Map</span>&lt;<span class="built_in">int</span>, <span class="built_in">String</span>&gt;();</span><br></pre></td></tr></table></figure>

<p>通过大括号语法可以为 map 添加，获取，设置元素。 使用 <code>remove()</code> 方法从 map 中移除键值对。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> nobleGases = &#123;<span class="number">54</span>: <span class="string">'xenon'</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 key 检索 value 。</span></span><br><span class="line"><span class="keyword">assert</span>(nobleGases[<span class="number">54</span>] == <span class="string">'xenon'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查 map 是否包含 key 。</span></span><br><span class="line"><span class="keyword">assert</span>(nobleGases.containsKey(<span class="number">54</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移除一个 key 及其 value。</span></span><br><span class="line">nobleGases.remove(<span class="number">54</span>);</span><br><span class="line"><span class="keyword">assert</span>(!nobleGases.containsKey(<span class="number">54</span>));</span><br></pre></td></tr></table></figure>

<p>可以从一个 map 中检索出所有的 key 或所有的 value：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hawaiianBeaches = &#123;</span><br><span class="line">  <span class="string">'Oahu'</span>: [<span class="string">'Waikiki'</span>, <span class="string">'Kailua'</span>, <span class="string">'Waimanalo'</span>],</span><br><span class="line">  <span class="string">'Big Island'</span>: [<span class="string">'Wailea Bay'</span>, <span class="string">'Pololu Beach'</span>],</span><br><span class="line">  <span class="string">'Kauai'</span>: [<span class="string">'Hanalei'</span>, <span class="string">'Poipu'</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取的所有的 key 是一个无序集合</span></span><br><span class="line"><span class="comment">// (可迭代 list 对象)。</span></span><br><span class="line"><span class="keyword">var</span> keys = hawaiianBeaches.keys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(keys.length == <span class="number">3</span>);</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">Set</span>.from(keys).contains(<span class="string">'Oahu'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取的所有的 value 是一个无序集合</span></span><br><span class="line"><span class="comment">// (可迭代 list 对象).</span></span><br><span class="line"><span class="keyword">var</span> values = hawaiianBeaches.values;</span><br><span class="line"><span class="keyword">assert</span>(values.length == <span class="number">3</span>);</span><br><span class="line"><span class="keyword">assert</span>(values.any((v) =&gt; v.contains(<span class="string">'Waikiki'</span>)));</span><br></pre></td></tr></table></figure>

<p>使用 <code>containsKey()</code> 方法检查一个 map 中是否包含某个key 。 因为 map 中的 value 可能会是 null ， 所有通过 key 获取 value，并通过判断 value 是否为 null 来判断 key 是否存在是不可靠的。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hawaiianBeaches = &#123;</span><br><span class="line">  <span class="string">'Oahu'</span>: [<span class="string">'Waikiki'</span>, <span class="string">'Kailua'</span>, <span class="string">'Waimanalo'</span>],</span><br><span class="line">  <span class="string">'Big Island'</span>: [<span class="string">'Wailea Bay'</span>, <span class="string">'Pololu Beach'</span>],</span><br><span class="line">  <span class="string">'Kauai'</span>: [<span class="string">'Hanalei'</span>, <span class="string">'Poipu'</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(hawaiianBeaches.containsKey(<span class="string">'Oahu'</span>));</span><br><span class="line"><span class="keyword">assert</span>(!hawaiianBeaches.containsKey(<span class="string">'Florida'</span>));</span><br></pre></td></tr></table></figure>

<p>如果当且仅当该 key 不存在于 map 中，且要为这个 key 赋值， 可使用<code>putIfAbsent（）</code>方法。 该方法需要一个方法返回这个 value 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> teamAssignments = &#123;&#125;;</span><br><span class="line">teamAssignments.putIfAbsent(</span><br><span class="line">    <span class="string">'Catcher'</span>, () =&gt; pickToughestKid());</span><br><span class="line"><span class="keyword">assert</span>(teamAssignments[<span class="string">'Catcher'</span>] != <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>

<p>全部的方法介绍 ，请参考 <a href="https://api.dartlang.org/stable/dart-core/Map-class.html" target="_blank" rel="noopener">Map API docs</a> 。</p>
<h4 id="公共集合方法"><a href="#公共集合方法" class="headerlink" title="公共集合方法"></a>公共集合方法</h4><p>List, Set, 和 Map 共享许多集合中的常用功能。 其中一些常见功能由 Iterable 类定义， 这些函数由 List 和 Set 实现。</p>
<p><strong>提示：</strong> 虽然Map没有实现 Iterable， 但可以使用 Map <code>keys</code> 和 <code>values</code> 属性从中获取 Iterable 对象。</p>
<p>使用 <code>isEmpty</code> 和 <code>isNotEmpty</code> 方法可以检查 list， set 或 map 对象中是否包含元素：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> coffees = [];</span><br><span class="line"><span class="keyword">var</span> teas = [<span class="string">'green'</span>, <span class="string">'black'</span>, <span class="string">'chamomile'</span>, <span class="string">'earl grey'</span>];</span><br><span class="line"><span class="keyword">assert</span>(coffees.isEmpty);</span><br><span class="line"><span class="keyword">assert</span>(teas.isNotEmpty);</span><br></pre></td></tr></table></figure>

<p>使用 <code>forEach()</code> 可以让 list， set 或 map 对象中的每个元素都使用一个方法。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> teas = [<span class="string">'green'</span>, <span class="string">'black'</span>, <span class="string">'chamomile'</span>, <span class="string">'earl grey'</span>];</span><br><span class="line"></span><br><span class="line">teas.forEach((tea) =&gt; <span class="built_in">print</span>(<span class="string">'I drink <span class="subst">$tea</span>'</span>));</span><br></pre></td></tr></table></figure>

<p>当在 map 对象上调用 `forEach() 方法时，函数必须带两个参数（key 和 value）：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hawaiianBeaches.forEach((k, v) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'I want to visit <span class="subst">$k</span> and swim at <span class="subst">$v</span>'</span>);</span><br><span class="line">  <span class="comment">// 我想去瓦胡岛并且在</span></span><br><span class="line">  <span class="comment">// [Waikiki, Kailua, Waimanalo]游泳， 等等。</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Iterable 提供 <code>map()</code> 方法，这个方法将所有结果返回到一个对象中。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> teas = [<span class="string">'green'</span>, <span class="string">'black'</span>, <span class="string">'chamomile'</span>, <span class="string">'earl grey'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loudTeas = teas.map((tea) =&gt; tea.toUpperCase());</span><br><span class="line">loudTeas.forEach(<span class="built_in">print</span>);</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong> <code>map()</code> 方法返回的对象是一个 <em>懒求值（lazily evaluated）</em>对象： 只有当访问对象里面的元素时，函数才会被调用。</p>
<p>使用 <code>map().toList()</code> 或 <code>map().toSet()</code> ， 可以强制在每个项目上立即调用函数。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loudTeas =</span><br><span class="line">    teas.map((tea) =&gt; tea.toUpperCase()).toList();</span><br></pre></td></tr></table></figure>

<p>使用 Iterable 的 <code>where()</code> 方法可以获取所有匹配条件的元素。 使用 Iterable 的 <code>any()</code> 和 <code>every()</code> 方法可以检查部分或者所有元素是否匹配某个条件。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> teas = [<span class="string">'green'</span>, <span class="string">'black'</span>, <span class="string">'chamomile'</span>, <span class="string">'earl grey'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 洋甘菊不含咖啡因。</span></span><br><span class="line"><span class="built_in">bool</span> isDecaffeinated(<span class="built_in">String</span> teaName) =&gt;</span><br><span class="line">    teaName == <span class="string">'chamomile'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 where() 来查找元素，</span></span><br><span class="line"><span class="comment">// 这些元素在给定的函数中返回 true 。</span></span><br><span class="line"><span class="keyword">var</span> decaffeinatedTeas =</span><br><span class="line">    teas.where((tea) =&gt; isDecaffeinated(tea));</span><br><span class="line"><span class="comment">// 或者 teas.where(isDecaffeinated)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 any() 来检查集合中是否至少有一个元素满足条件。</span></span><br><span class="line"><span class="keyword">assert</span>(teas.any(isDecaffeinated));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 every() 来检查集合中是否所有元素满足条件。</span></span><br><span class="line"><span class="keyword">assert</span>(!teas.every(isDecaffeinated));</span><br></pre></td></tr></table></figure>

<p>有关方法的完整列表，请参考 <a href="https://api.dartlang.org/stable/dart-core/Iterable-class.html" target="_blank" rel="noopener">Iterable API docs,</a> 以及 <a href="https://api.dartlang.org/stable/dart-core/List-class.html" target="_blank" rel="noopener">List,</a> <a href="https://api.dartlang.org/stable/dart-core/Set-class.html" target="_blank" rel="noopener">Set,</a> and <a href="https://api.dartlang.org/stable/dart-core/Map-class.html" target="_blank" rel="noopener">Map.</a></p>
<h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><p>在使用 URI（可能你会称它为 <em>URLs</em>） 时，<a href="https://api.dartlang.org/stable/dart-core/Uri-class.html" target="_blank" rel="noopener">Uri 类</a> 提供对字符串的编解码操作。 这些函数用来处理 URI 特有的字符，例如 <code>＆</code> 和 <code>=</code> 。 Uri 类还可以解析和处理 URI—host，port，scheme等组件。</p>
<h4 id="编码和解码完整合法的URI"><a href="#编码和解码完整合法的URI" class="headerlink" title="编码和解码完整合法的URI"></a>编码和解码完整合法的URI</h4><p>使用 <code>encodeFull()</code> 和 <code>decodeFull()</code> 方法， 对 URI 中除了特殊字符（例如 <code>/</code>， <code>:</code>， <code>&amp;</code>， <code>#</code>）以外的字符进行编解码， 这些方法非常适合编解码完整合法的 URI，并保留 URI 中的特殊字符。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri = <span class="string">'http://example.org/api?foo=some message'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encoded = <span class="built_in">Uri</span>.encodeFull(uri);</span><br><span class="line"><span class="keyword">assert</span>(encoded ==</span><br><span class="line">    <span class="string">'http://example.org/api?foo=some%20message'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> decoded = <span class="built_in">Uri</span>.decodeFull(encoded);</span><br><span class="line"><span class="keyword">assert</span>(uri == decoded);</span><br></pre></td></tr></table></figure>

<p>注意上面代码只编码了 <code>some</code> 和 <code>message</code> 之间的空格。</p>
<h4 id="编码和解码-URI-组件"><a href="#编码和解码-URI-组件" class="headerlink" title="编码和解码 URI 组件"></a>编码和解码 URI 组件</h4><p>使用 <code>encodeComponent()</code> 和 <code>decodeComponent()</code> 方法， 对 URI 中具有特殊含义的所有字符串字符，特殊字符包括（但不限于）<code>/</code>， <code>&amp;</code>， 和 <code>:</code>。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri = <span class="string">'http://example.org/api?foo=some message'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> encoded = <span class="built_in">Uri</span>.encodeComponent(uri);</span><br><span class="line"><span class="keyword">assert</span>(encoded ==</span><br><span class="line">    <span class="string">'http%3A%2F%2Fexample.org%2Fapi%3Ffoo%3Dsome%20message'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> decoded = <span class="built_in">Uri</span>.decodeComponent(encoded);</span><br><span class="line"><span class="keyword">assert</span>(uri == decoded);</span><br></pre></td></tr></table></figure>

<p>注意上面代码编码了所有的字符。例如 <code>/</code> 被编码为 <code>%2F</code>。</p>
<h4 id="解析-URI"><a href="#解析-URI" class="headerlink" title="解析 URI"></a>解析 URI</h4><p>使用 Uri 对象的字段（例如 <code>path</code>）， 来获取一个 Uri 对象或者 URI 字符串的一部分。 使用 <code>parse()</code> 静态方法，可以使用字符串创建 Uri 对象。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri =</span><br><span class="line">    <span class="built_in">Uri</span>.parse(<span class="string">'http://example.org:8080/foo/bar#frag'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(uri.scheme == <span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">assert</span>(uri.host == <span class="string">'example.org'</span>);</span><br><span class="line"><span class="keyword">assert</span>(uri.path == <span class="string">'/foo/bar'</span>);</span><br><span class="line"><span class="keyword">assert</span>(uri.fragment == <span class="string">'frag'</span>);</span><br><span class="line"><span class="keyword">assert</span>(uri.origin == <span class="string">'http://example.org:8080'</span>);</span><br></pre></td></tr></table></figure>

<p>有关 URI 组件的更多内容，参考 <a href="https://api.dartlang.org/stable/dart-core/Uri-class.html" target="_blank" rel="noopener">Uri API docs</a> 。</p>
<h4 id="构建-URI"><a href="#构建-URI" class="headerlink" title="构建 URI"></a>构建 URI</h4><p>使用 <code>Uri()</code> 构造函数，可以将各组件部分构建成 URI 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri = <span class="built_in">Uri</span>(</span><br><span class="line">    scheme: <span class="string">'http'</span>,</span><br><span class="line">    host: <span class="string">'example.org'</span>,</span><br><span class="line">    path: <span class="string">'/foo/bar'</span>,</span><br><span class="line">    fragment: <span class="string">'frag'</span>);</span><br><span class="line"><span class="keyword">assert</span>(</span><br><span class="line">    uri.toString() == <span class="string">'http://example.org/foo/bar#frag'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><p>DateTime 对象代表某个时刻，时区可以是 UTC 或者 本地时区。</p>
<p>DateTime 对象可以通过若干构造函数创建：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取当前时刻。</span></span><br><span class="line"><span class="keyword">var</span> now = <span class="built_in">DateTime</span>.now();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更具本地时区创建 DateTime 对象。</span></span><br><span class="line"><span class="keyword">var</span> y2k = <span class="built_in">DateTime</span>(<span class="number">2000</span>); <span class="comment">// January 1, 2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定年月日。</span></span><br><span class="line">y2k = <span class="built_in">DateTime</span>(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">2</span>); <span class="comment">// January 2, 2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 将日期指定为 UTC 时区。</span></span><br><span class="line">y2k = <span class="built_in">DateTime</span>.utc(<span class="number">2000</span>); <span class="comment">// 1/1/2000, UTC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定自Unix纪元以来，以毫秒为单位的日期和时间。</span></span><br><span class="line">y2k = <span class="built_in">DateTime</span>.fromMillisecondsSinceEpoch(<span class="number">946684800000</span>,</span><br><span class="line">    isUtc: <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析ISO 8601日期。</span></span><br><span class="line">y2k = <span class="built_in">DateTime</span>.parse(<span class="string">'2000-01-01T00:00:00Z'</span>);</span><br></pre></td></tr></table></figure>

<p>日期中 <code>millisecondsSinceEpoch</code> 属性返回自 “Unix纪元（January 1, 1970, UTC）“以来的毫秒数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1/1/2000, UTC</span></span><br><span class="line"><span class="keyword">var</span> y2k = <span class="built_in">DateTime</span>.utc(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">assert</span>(y2k.millisecondsSinceEpoch == <span class="number">946684800000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1/1/1970, UTC</span></span><br><span class="line"><span class="keyword">var</span> unixEpoch = <span class="built_in">DateTime</span>.utc(<span class="number">1970</span>);</span><br><span class="line"><span class="keyword">assert</span>(unixEpoch.millisecondsSinceEpoch == <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>使用 Duration 类来计算两个日期的查，也可以对时刻进行前移和后移操作：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> y2k = <span class="built_in">DateTime</span>.utc(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增加一年。</span></span><br><span class="line"><span class="keyword">var</span> y2001 = y2k.add(<span class="keyword">const</span> <span class="built_in">Duration</span>(days: <span class="number">366</span>));</span><br><span class="line"><span class="keyword">assert</span>(y2001.year == <span class="number">2001</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 减少30天。</span></span><br><span class="line"><span class="keyword">var</span> december2000 =</span><br><span class="line">    y2001.subtract(<span class="keyword">const</span> <span class="built_in">Duration</span>(days: <span class="number">30</span>));</span><br><span class="line"><span class="keyword">assert</span>(december2000.year == <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">assert</span>(december2000.month == <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算两个时刻之间的查，</span></span><br><span class="line"><span class="comment">// 返回 Duration 对象。</span></span><br><span class="line"><span class="keyword">var</span> duration = y2001.difference(y2k);</span><br><span class="line"><span class="keyword">assert</span>(duration.inDays == <span class="number">366</span>); <span class="comment">// y2k was a leap year.</span></span><br></pre></td></tr></table></figure>

<p><strong>警告：</strong> 由于时钟转换（例如，夏令时）的原因， 使用 Duration 对 DateTime 按天移动可能会有问题。 如果要按照天数来位移时间，请使用 UTC 日期。</p>
<p>参考 <a href="https://api.dartlang.org/stable/dart-core/DateTime-class.html" target="_blank" rel="noopener">DateTime</a> 和 <a href="https://api.dartlang.org/stable/dart-core/Duration-class.html" target="_blank" rel="noopener">Duration</a> API 文档了解全部方法列表。</p>
<h3 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h3><p>核心库包含各种工具类，可用于排序，映射值以及迭代。</p>
<h4 id="比较对象"><a href="#比较对象" class="headerlink" title="比较对象"></a>比较对象</h4><p>如果实现了 <a href="https://api.dartlang.org/stable/dart-core/Comparable-class.html" target="_blank" rel="noopener">Comparable</a> 接口， 也就是说可以将该对象与另一个对象进行比较， 通常用于排序。 <code>compareTo()</code> 方法在 <em>小于</em> 时返回 &lt; 0， 在 <em>相等</em> 时返回 0， 在 <em>大于</em> 时返回 &gt; 0。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Line</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Line</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> length;</span><br><span class="line">  <span class="keyword">const</span> Line(<span class="keyword">this</span>.length);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">int</span> compareTo(Line other) =&gt; length - other.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> short = <span class="keyword">const</span> Line(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">var</span> long = <span class="keyword">const</span> Line(<span class="number">100</span>);</span><br><span class="line">  <span class="keyword">assert</span>(short.compareTo(long) &lt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Implementing-map-keys"><a href="#Implementing-map-keys" class="headerlink" title="Implementing map keys"></a>Implementing map keys</h4><p>在 Dart 中每个对象会默认提供一个整数的哈希值， 因此在 map 中可以作为 key 来使用， 重写 <code>hashCode</code> 的 getter 方法来生成自定义哈希值。 如果重写 <code>hashCode</code> 的 getter 方法，那么可能还需要重写 <code>==</code> 运算符。 相等的（通过 <code>==</code> ）对象必须拥有相同的哈希值。 哈希值并不要求是唯一的， 但是应该具有良好的分布形态。。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> firstName, lastName;</span><br><span class="line"></span><br><span class="line">  Person(<span class="keyword">this</span>.firstName, <span class="keyword">this</span>.lastName);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重写 hashCode，实现策略源于  Effective Java，</span></span><br><span class="line">  <span class="comment">// 第11章。</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">int</span> <span class="keyword">get</span> hashCode &#123;</span><br><span class="line">    <span class="built_in">int</span> result = <span class="number">17</span>;</span><br><span class="line">    result = <span class="number">37</span> * result + firstName.hashCode;</span><br><span class="line">    result = <span class="number">37</span> * result + lastName.hashCode;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果重写了 hashCode，通常应该从新实现 == 操作符。</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">operator</span> ==(<span class="built_in">dynamic</span> other) &#123;</span><br><span class="line">    <span class="keyword">if</span> (other <span class="keyword">is</span>! Person) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    Person person = other;</span><br><span class="line">    <span class="keyword">return</span> (person.firstName == firstName &amp;&amp;</span><br><span class="line">        person.lastName == lastName);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="keyword">var</span> p1 = Person(<span class="string">'Bob'</span>, <span class="string">'Smith'</span>);</span><br><span class="line">  <span class="keyword">var</span> p2 = Person(<span class="string">'Bob'</span>, <span class="string">'Smith'</span>);</span><br><span class="line">  <span class="keyword">var</span> p3 = <span class="string">'not a person'</span>;</span><br><span class="line">  <span class="keyword">assert</span>(p1.hashCode == p2.hashCode);</span><br><span class="line">  <span class="keyword">assert</span>(p1 == p2);</span><br><span class="line">  <span class="keyword">assert</span>(p1 != p3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h4><p>Iterable][] 和 <a href="https://api.dartlang.org/stable/dart-core/Iterator-class.html" target="_blank" rel="noopener">Iterator</a> 类支持 for-in 循环。 当创建一个类的时候，继承或者实现 Iterable，可以为该类提供用于 for-in 循环的 Iterators。 实现 Iterator 来定义实际的遍历操作。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Process</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Represents a process...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Process</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Process <span class="keyword">get</span> current =&gt; ...</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> moveNext() =&gt; ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A mythical class that lets you iterate through all</span></span><br><span class="line"><span class="comment">// processes. Extends a subclass of [Iterable].</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Processes</span> <span class="keyword">extends</span> <span class="title">IterableBase</span>&lt;<span class="title">Process</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Iterator</span>&lt;Process&gt; iterator = ProcessIterator();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  <span class="comment">// Iterable objects can be used with for-in.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> process <span class="keyword">in</span> Processes()) &#123;</span><br><span class="line">    <span class="comment">// Do something with the process.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><p>Dart 核心库定义了很多公共的异常和错误类。 异常通常是一些可以预见和预知的情况。 错误是无法预见或者预防的情况。</p>
<p>两个最常见的错误：</p>
<ul>
<li><p><a href="https://api.dartlang.org/stable/dart-core/NoSuchMethodError-class.html" target="_blank" rel="noopener">NoSuchMethodError</a></p>
<p>当方法的接受对象（可能为null）没有实现该方法时抛出。</p>
</li>
<li><p><a href="https://api.dartlang.org/stable/dart-core/ArgumentError-class.html" target="_blank" rel="noopener">ArgumentError</a></p>
<p>当方法在接受到一个不合法参数时抛出。</p>
</li>
</ul>
<p>通常通过抛出一个应用特定的异常，来表示应用发生了错误。 通过实现 Exception 接口来自定义异常。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooException</span> <span class="keyword">implements</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> msg;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> FooException([<span class="keyword">this</span>.msg]);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() =&gt; msg ?? <span class="string">'FooException'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多内容，参考 <a href="https://www.dartcn.com/guides/libraries/library-tour#exceptions" target="_blank" rel="noopener">Exceptions</a> 以及 <a href="https://api.dartlang.org/stable/dart-core/Exception-class.html" target="_blank" rel="noopener">Exception API 文档。</a></p>
<h2 id="dart-async-异步编程"><a href="#dart-async-异步编程" class="headerlink" title="dart:async - 异步编程"></a>dart:async - 异步编程</h2><p>异步编程通常使用回调方法来实现，但是 Dart 提供了其他方案：<a href="https://api.dartlang.org/stable/dart-async/Future-class.html" target="_blank" rel="noopener">Future</a> 和 <a href="https://api.dartlang.org/stable/dart-async/Stream-class.html" target="_blank" rel="noopener">Stream</a> 对象。 Future 类似与 JavaScript 中的 Promise ， 代表在将来某个时刻会返回一个结果。 Stream 类可以用来获取一系列的值，比如，一些列事件。 Future， Stream，以及更多内容，参考 dart:async library (<a href="https://api.dartlang.org/stable/dart-async/dart-async-library.html" target="_blank" rel="noopener">API reference</a>)。</p>
<p><strong>提示：</strong> 你并不总是需要直接使用 Future 或 Stream 的 API。 Dart 语言支持使用关键字（例如，<code>async</code> 和 <code>await</code> ）来实现异步编程。 更多详情，参考语言概览中 <a href="https://www.dartcn.com/guides/language/language-tour#asynchrony-support" target="_blank" rel="noopener">Asynchrony support</a>。</p>
<p>dart:async 库可以工作在 web 应用及 command-line 应用。 通过 import dart:async 来使用。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br></pre></td></tr></table></figure>

<p><strong>版本提示：</strong> 从 Dart 2.1 开始，使用 Future 和 Stream 不需要导入 dart:async ， 因为 dart:core 库 export 了这些类。</p>
<h3 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h3><p>在 Dart 库中随处可见 Future 对象，通常异步函数返回的对象就是一个 Future。 当一个 future <em>完成执行后</em>，future 中的值就已经可以使用了。</p>
<h4 id="使用-await"><a href="#使用-await" class="headerlink" title="使用 await"></a>使用 await</h4><p>在直接使用 Future API 前，首先应该考虑 <code>await</code> 来替代。 代码中使用 <code>await</code> 表达式会比直接使用 Future API 更容易理解。</p>
<p>阅读思考下面代码。 代码使用 Future 的 <code>then()</code> 方法在同一行执行了三个异步函数， 要等待上一个执行完成，再执行下一个任务之。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runUsingFuture() &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  findEntryPoint().then((entryPoint) &#123;</span><br><span class="line">    <span class="keyword">return</span> runExecutable(entryPoint, args);</span><br><span class="line">  &#125;).then(flushThenExit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过 await 表达式实现等价的代码， 看起来非常像同步代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runUsingAsyncAwait() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">var</span> entryPoint = <span class="keyword">await</span> findEntryPoint();</span><br><span class="line">  <span class="keyword">var</span> exitCode = <span class="keyword">await</span> runExecutable(entryPoint, args);</span><br><span class="line">  <span class="keyword">await</span> flushThenExit(exitCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>async 函数能够捕获来自 Future 的异常。 例如：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> entryPoint = <span class="keyword">await</span> findEntryPoint();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> exitCode = <span class="keyword">await</span> runExecutable(entryPoint, args);</span><br><span class="line">  <span class="keyword">await</span> flushThenExit(exitCode);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Handle the error...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>重要：</strong> async 函数 返回 Future 对象。 如果你不希望你的函数返回一个 future 对象， 可以使用其他方案。 例如，你可以在你的方法中调用一个 async 方法。</p>
<p>更多关于 <code>await</code> 的使用及相关的 Dart 语言特征，参考 <a href="https://www.dartcn.com/guides/language/language-tour#asynchrony-support" target="_blank" rel="noopener">Asynchrony support</a>。</p>
<h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p>当 future 执行完成后，<code>then()</code> 中的代码会被执行。</p>
<p><code>then()</code> 中的代码会在 future 完成后被执行。 例如， <code>HttpRequest.getString()</code> 返回一个 future 对象，因为 HTTP 请求可能需要一段时间。 当 Future 完成并且保证字符串值有效后，使用 <code>then()</code> 来执行你需要的代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest.getString(url).then((<span class="built_in">String</span> result) &#123;</span><br><span class="line">  <span class="built_in">print</span>(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用 <code>catchError()</code> 来处理一些 Future 对象可能抛出的错误或者异常。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpRequest.getString(url).then((<span class="built_in">String</span> result) &#123;</span><br><span class="line">  <span class="built_in">print</span>(result);</span><br><span class="line">&#125;).catchError((e) &#123;</span><br><span class="line">  <span class="comment">// Handle or ignore the error.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>then().catchError()</code> 组合是 <code>try</code>-<code>catch</code> 的异步版本。</p>
<p><strong>重要：</strong> 确保调用 <code>catchError()</code> 方式在 <code>then()</code> 的结果上，而不是在原来的 Future 对象上调用。 否则的话，<code>catchError()</code> 就只能处理原来 Future 对象抛出的异常， 而无法处理 <code>then()</code> 代码里面的异常。</p>
<h4 id="链式异步编程"><a href="#链式异步编程" class="headerlink" title="链式异步编程"></a>链式异步编程</h4><p><code>then()</code> 方法返回一个 Future 对象， 这样就提供了一个非常好的方式让多个异步方法按顺序依次执行。 如果用 <code>then()</code> 注册的回调返回一个 Future ， 那么 <code>then()</code> 返回一个等价的 Future 。 如果回调返回任何其他类型的值， 那么 <code>then()</code> 会创建一个以该值完成的新 Future 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Future result = costlyQuery(url);</span><br><span class="line">result</span><br><span class="line">    .then((value) =&gt; expensiveWork(value))</span><br><span class="line">    .then((_) =&gt; lengthyComputation())</span><br><span class="line">    .then((_) =&gt; <span class="built_in">print</span>(<span class="string">'Done!'</span>))</span><br><span class="line">    .catchError((exception) &#123;</span><br><span class="line">  <span class="comment">/* Handle exception... */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，方法按下面顺序执行：</p>
<ol>
<li><code>costlyQuery()</code></li>
<li><code>expensiveWork()</code></li>
<li><code>lengthyComputation()</code></li>
</ol>
<p>这是使用 await 编写的等效代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> value = <span class="keyword">await</span> costlyQuery(url);</span><br><span class="line">  <span class="keyword">await</span> expensiveWork(value);</span><br><span class="line">  <span class="keyword">await</span> lengthyComputation();</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Done!'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">/* Handle exception... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="等待多个-Future"><a href="#等待多个-Future" class="headerlink" title="等待多个 Future"></a>等待多个 Future</h4><p>有时代码逻辑需要调用多个异步函数， 并等待它们全部完成后再继续执行。 使用 <a href="https://api.dartlang.org/stable/dart-async/Future/wait.html" target="_blank" rel="noopener">Future.wait()</a> 静态方法管理多个 Future 以及等待它们完成：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Future deleteLotsOfFiles() <span class="keyword">async</span> =&gt;  ...</span><br><span class="line">Future copyLotsOfFiles() <span class="keyword">async</span> =&gt;  ...</span><br><span class="line">Future checksumLotsOfOtherFiles() <span class="keyword">async</span> =&gt;  ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> Future.wait([</span><br><span class="line">  deleteLotsOfFiles(),</span><br><span class="line">  copyLotsOfFiles(),</span><br><span class="line">  checksumLotsOfOtherFiles(),</span><br><span class="line">]);</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Done with all the long steps!'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><p>在 Dart API 中 Stream 对象随处可见，Stream 用来表示一些列数据。 例如，HTML 中的按钮点击就是通过 stream 传递的。 同样也可以将文件作为数据流来读取。</p>
<h4 id="异步循环"><a href="#异步循环" class="headerlink" title="异步循环"></a>异步循环</h4><p>有时，可以使用异步 for 循环 <code>await for</code> ，来替代 Stream API 。</p>
<p>思考下面示例函数。 它使用 Stream 的 <code>listen()</code> 方法来订阅文件列表， 传入一个搜索文件或目录的函数。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arguments) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  FileSystemEntity.isDirectory(searchPath).then((isDir) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDir) &#123;</span><br><span class="line">      <span class="keyword">final</span> startingDir = Directory(searchPath);</span><br><span class="line">      startingDir</span><br><span class="line">          .list(</span><br><span class="line">              recursive: argResults[recursive],</span><br><span class="line">              followLinks: argResults[followLinks])</span><br><span class="line">          .listen((entity) &#123;</span><br><span class="line">        <span class="keyword">if</span> (entity <span class="keyword">is</span> File) &#123;</span><br><span class="line">          searchFile(entity, searchTerms);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      searchFile(File(searchPath), searchTerms);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是使用 await 表达式和异步 for 循环 (<code>await for</code>) 实现的等价的代码， 看起来更像是同步代码：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Future main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; arguments) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">await</span> FileSystemEntity.isDirectory(searchPath)) &#123;</span><br><span class="line">    <span class="keyword">final</span> startingDir = Directory(searchPath);</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> entity <span class="keyword">in</span> startingDir.list(</span><br><span class="line">        recursive: argResults[recursive],</span><br><span class="line">        followLinks: argResults[followLinks])) &#123;</span><br><span class="line">      <span class="keyword">if</span> (entity <span class="keyword">is</span> File) &#123;</span><br><span class="line">        searchFile(entity, searchTerms);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    searchFile(File(searchPath), searchTerms);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>重要：</strong> 在使用 <code>await for</code> 前，确认这样能保持代码清晰， 并希望获取所有 stream 的结果。 例如，你通常并 <strong>不</strong> 会使用 <code>await for</code> 来监听 DOM 事件， 因为 DOM 会发送无尽的流事件。 如果在同一行使用 <code>await for</code> 注册两个 DOM 事件， 那么第二个事件永远不会被处理。</p>
<p>有关 <code>await</code> 的使用及 Dart 语言的相关信息，参考 <a href="https://www.dartcn.com/guides/language/language-tour#asynchrony-support" target="_blank" rel="noopener">Asynchrony support</a>。</p>
<h4 id="监听流数据（stream-data）"><a href="#监听流数据（stream-data）" class="headerlink" title="监听流数据（stream data）"></a>监听流数据（stream data）</h4><p>使用 <code>await for</code> 或者使用 <code>listen()</code> 方法监听 stream， 来获取每个到达的数据流值：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过 ID 获取 button 并添加事件处理函数。</span></span><br><span class="line"><span class="built_in">querySelector</span>(<span class="string">'#submitInfo'</span>).onClick.listen((e) &#123;</span><br><span class="line">  <span class="comment">// 当 button 被点击是，该代码会执行。</span></span><br><span class="line">  submitData();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>下面示例中，ID 为 “submitInfo” button 提供的 <code>onClick</code> 属性是一个 Stream 对象。</p>
<p>如果只关心其中一个事件，可以使用，例如，<code>first</code>， <code>last</code>，或 <code>single</code> 属性来获取。 要在处理时间前对事件进行测试，可以使用，例如 <code>firstWhere()</code>， <code>lastWhere()</code>， 或 <code>singleWhere()</code> 方法。</p>
<p>如果只关心事件中的一个子集，可以使用，例如，<code>skip()</code>， <code>skipWhile()</code>，<code>take()</code>，<code>takeWhile()</code>， 和 <code>where()</code>。</p>
<h4 id="传递流数据（stream-data）"><a href="#传递流数据（stream-data）" class="headerlink" title="传递流数据（stream data）"></a>传递流数据（stream data）</h4><p>常常，在使用流数据前需要改变数据的格式。 使用 <code>transform()</code> 方法生成具有不同类型数据的流：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lines = inputStream</span><br><span class="line">    .transform(utf8.decoder)</span><br><span class="line">    .transform(LineSplitter());</span><br></pre></td></tr></table></figure>

<p>上面例子中使用了两个 transformer 。 第一个使用 utf8.decoder 将整型流转换为字符串流。 接着，使用了 LineSplitter 将字符串流转换为多行字符串流。 这些 transformer 来自 dart:convert 库 （参考<a href="https://www.dartcn.com/guides/libraries/library-tour#dartconvert---decoding-and-encoding-json-utf-8-and-more" target="_blank" rel="noopener">dart:convert section</a>）。</p>
<h4 id="处理错误和完成"><a href="#处理错误和完成" class="headerlink" title="处理错误和完成"></a>处理错误和完成</h4><p>处理错误和完成代码方式， 取决于使用的是 异步 for 循环（<code>await for</code>）还是 Stream API 。</p>
<p>如果使用的是异步 for 循环， 那么通过 try-catch 来处理错误。 代码位于异步 for 循环之后， 会在 stream 被关闭后执行。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Future readFileAwaitFor() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> config = File(<span class="string">'config.txt'</span>);</span><br><span class="line">  Stream&lt;<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;&gt; inputStream = config.openRead();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> lines = inputStream</span><br><span class="line">      .transform(utf8.decoder)</span><br><span class="line">      .transform(LineSplitter());</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> line <span class="keyword">in</span> lines) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">'Got <span class="subst">$&#123;line.length&#125;</span> characters from stream'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'file is now closed'</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">print</span>(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果使用的是 Stream API， 那么通过注册 <code>onError</code> 监听来处理错误。 代码位于注册的 <code>onDone</code> 中， 会在 stream 被关闭后执行。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> config = File(<span class="string">'config.txt'</span>);</span><br><span class="line">Stream&lt;<span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt;&gt; inputStream = config.openRead();</span><br><span class="line"></span><br><span class="line">inputStream</span><br><span class="line">    .transform(utf8.decoder)</span><br><span class="line">    .transform(LineSplitter())</span><br><span class="line">    .listen((<span class="built_in">String</span> line) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Got <span class="subst">$&#123;line.length&#125;</span> characters from stream'</span>);</span><br><span class="line">&#125;, onDone: () &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'file is now closed'</span>);</span><br><span class="line">&#125;, onError: (e) &#123;</span><br><span class="line">  <span class="built_in">print</span>(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更多内容"><a href="#更多内容" class="headerlink" title="更多内容"></a>更多内容</h3><p>更多在 command-line 应用中使用 Future 和 Stream 的实例，参考 <a href="https://www.dartcn.com/server/io-library-tour" target="_blank" rel="noopener">dart:io tour.</a> 也可以参考下列文章和教程：</p>
<ul>
<li><a href="https://www.dartcn.com/tutorials/language/futures" target="_blank" rel="noopener">Asynchronous Programming: Futures</a></li>
<li><a href="https://www.dartcn.com/guides/libraries/futures-error-handling" target="_blank" rel="noopener">Futures and Error Handling</a></li>
<li><a href="https://webdev.dartlang.org/articles/performance/event-loop" target="_blank" rel="noopener">The Event Loop and Dart</a></li>
<li><a href="https://www.dartcn.com/tutorials/language/streams" target="_blank" rel="noopener">Asynchronous Programming: Streams</a></li>
<li><a href="https://www.dartcn.com/articles/libraries/creating-streams" target="_blank" rel="noopener">Creating Streams in Dart</a></li>
</ul>
<h2 id="dart-math-数学和随机数"><a href="#dart-math-数学和随机数" class="headerlink" title="dart:math - 数学和随机数"></a>dart:math - 数学和随机数</h2><p>dart:math 库（<a href="https://api.dartlang.org/stable/dart-math/dart-math-library.html" target="_blank" rel="noopener">API reference</a>） 提供通用的功能，例如，正弦和余弦， 最大值和最小值，以及数学常数，例如 <em>pi</em> 和 <em>e</em>。 大多数在 Math 库中的功能是作为顶级函数实现的。</p>
<p>通过 import dart:math 来引入使用该库。 下面的实例中使用 <code>math</code> 前缀，来说明顶级函数及常量源于 Math 库。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:math'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h3><p>Math 库提供基本的三角函数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Cosine</span></span><br><span class="line"><span class="keyword">assert</span>(cos(pi) == <span class="number">-1.0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sine</span></span><br><span class="line"><span class="keyword">var</span> degrees = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">var</span> radians = degrees * (pi / <span class="number">180</span>);</span><br><span class="line"><span class="comment">// radians is now 0.52359.</span></span><br><span class="line"><span class="keyword">var</span> sinOf30degrees = sin(radians);</span><br><span class="line"><span class="comment">// sin 30° = 0.5</span></span><br><span class="line"><span class="keyword">assert</span>((sinOf30degrees - <span class="number">0.5</span>).abs() &lt; <span class="number">0.01</span>);</span><br></pre></td></tr></table></figure>

<p><strong>提示：</strong> 这些函数参数单位是弧度，不是角度！</p>
<h3 id="最大值和最小值"><a href="#最大值和最小值" class="headerlink" title="最大值和最小值"></a>最大值和最小值</h3><p>Math 库提供 <code>max()</code> 和 <code>min()</code> 方法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(max(<span class="number">1</span>, <span class="number">1000</span>) == <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">assert</span>(min(<span class="number">1</span>, <span class="number">-1000</span>) == <span class="number">-1000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="数学常数"><a href="#数学常数" class="headerlink" title="数学常数"></a>数学常数</h3><p>在 Math 库中可以找到你需要的数学常熟，例如，<em>pi*， *e</em> 等等：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// See the Math library for additional constants.</span></span><br><span class="line"><span class="built_in">print</span>(e); <span class="comment">// 2.718281828459045</span></span><br><span class="line"><span class="built_in">print</span>(pi); <span class="comment">// 3.141592653589793</span></span><br><span class="line"><span class="built_in">print</span>(sqrt2); <span class="comment">// 1.4142135623730951</span></span><br></pre></td></tr></table></figure>

<h3 id="随机数"><a href="#随机数" class="headerlink" title="随机数"></a>随机数</h3><p>使用 <a href="https://api.dartlang.org/stable/dart-math/Random-class.html" target="_blank" rel="noopener">Random</a> 类产生随机数。 可以为 Random 构造函数提供一个可选的种子参数。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> random = Random();</span><br><span class="line">random.nextDouble(); <span class="comment">// Between 0.0 and 1.0: [0, 1)</span></span><br><span class="line">random.nextInt(<span class="number">10</span>); <span class="comment">// Between 0 and 9.</span></span><br></pre></td></tr></table></figure>

<p>也可以产生随机布尔值序列：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> random = Random();</span><br><span class="line">random.nextBool(); <span class="comment">// true or false</span></span><br></pre></td></tr></table></figure>

<h3 id="更多内容-1"><a href="#更多内容-1" class="headerlink" title="更多内容"></a>更多内容</h3><p>完整方法列表参考 <a href="https://api.dartlang.org/stable/dart-math/dart-math-library.html" target="_blank" rel="noopener">Math API docs</a>。 在 API 文档中参考 <a href="https://api.dartlang.org/stable/dart-core/num-class.html" target="_blank" rel="noopener">num,</a> <a href="https://api.dartlang.org/stable/dart-core/int-class.html" target="_blank" rel="noopener">int,</a> 和 <a href="https://api.dartlang.org/stable/dart-core/double-class.html" target="_blank" rel="noopener">double</a>。</p>
<h2 id="dart-convert-编解码JSON，UTF-8等"><a href="#dart-convert-编解码JSON，UTF-8等" class="headerlink" title="dart:convert - 编解码JSON，UTF-8等"></a>dart:convert - 编解码JSON，UTF-8等</h2><p>dart:convert 库 （<a href="https://api.dartlang.org/stable/dart-convert/dart-convert-library.html" target="_blank" rel="noopener">API reference</a>）提供 JSON 和 UTF-8 转换器， 以及创建其他转换器。 <a href="https://www.json.org/" target="_blank" rel="noopener">JSON</a> 是一种用于表示结构化对象和集合的简单文本格式。 <a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a> 是一种常见的可变宽度编码，可以表示Unicode字符集中的每个字符。</p>
<p>dart:convert 库可以在 web 及 命令行应用中使用。 使用时，通过 import dart:convert 引入。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:convert'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="编解码JSON"><a href="#编解码JSON" class="headerlink" title="编解码JSON"></a>编解码JSON</h3><p>使用 <code>jsonDecode()</code> 解码 JSON 编码的字符串为 Dart 对象：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提示：在 JSON 字符串中，必须使用双引号（"）,</span></span><br><span class="line"><span class="comment">// 而不是单引号（'）。</span></span><br><span class="line"><span class="comment">// 下面是 JSON 字符串，非 Dart 字符串。</span></span><br><span class="line"><span class="keyword">var</span> jsonString = <span class="string">'''</span></span><br><span class="line"><span class="string">  [</span></span><br><span class="line"><span class="string">    &#123;"score": 40&#125;,</span></span><br><span class="line"><span class="string">    &#123;"score": 80&#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">'''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scores = jsonDecode(jsonString);</span><br><span class="line"><span class="keyword">assert</span>(scores <span class="keyword">is</span> <span class="built_in">List</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> firstScore = scores[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">assert</span>(firstScore <span class="keyword">is</span> <span class="built_in">Map</span>);</span><br><span class="line"><span class="keyword">assert</span>(firstScore[<span class="string">'score'</span>] == <span class="number">40</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>jsonEncode()</code> 编码 Dart 对象为 JSON 格式的字符串：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scores = [</span><br><span class="line">  &#123;<span class="string">'score'</span>: <span class="number">40</span>&#125;,</span><br><span class="line">  &#123;<span class="string">'score'</span>: <span class="number">80</span>&#125;,</span><br><span class="line">  &#123;<span class="string">'score'</span>: <span class="number">100</span>, <span class="string">'overtime'</span>: <span class="keyword">true</span>, <span class="string">'special_guest'</span>: <span class="keyword">null</span>&#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonText = jsonEncode(scores);</span><br><span class="line"><span class="keyword">assert</span>(jsonText ==</span><br><span class="line">    <span class="string">'[&#123;"score":40&#125;,&#123;"score":80&#125;,'</span></span><br><span class="line">    <span class="string">'&#123;"score":100,"overtime":true,'</span></span><br><span class="line">    <span class="string">'"special_guest":null&#125;]'</span>);</span><br></pre></td></tr></table></figure>

<p>只有 int， double， String， bool, null, List, 或者 Map 类型对象可以直接编码成 JSON。 List 和 Map 对象进行递归编码。</p>
<p>不能直接编码的对象有两种方式对其编码。 第一种方式是调用 <code>encode()</code> 时赋值第二个参数， 这个参数是一个函数， 该函数返回一个能够直接编码的对象 第二种方式是省略第二个参数，着这种情况下编码器调用对象的 <code>toJson()</code> 方法。 更多示例及 JSON 包相关链接，参考 <a href="https://www.dartcn.com/guides/json" target="_blank" rel="noopener">JSON Support</a> 。</p>
<h3 id="编解码-UTF-8-字符"><a href="#编解码-UTF-8-字符" class="headerlink" title="编解码 UTF-8 字符"></a>编解码 UTF-8 字符</h3><p>使用 <code>utf8.decode()</code> 解码 UTF8 编码的字符创为 Dart 字符创：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; utf8Bytes = [</span><br><span class="line">  <span class="number">0xc3</span>, <span class="number">0x8e</span>, <span class="number">0xc3</span>, <span class="number">0xb1</span>, <span class="number">0xc5</span>, <span class="number">0xa3</span>, <span class="number">0xc3</span>, <span class="number">0xa9</span>,</span><br><span class="line">  <span class="number">0x72</span>, <span class="number">0xc3</span>, <span class="number">0xb1</span>, <span class="number">0xc3</span>, <span class="number">0xa5</span>, <span class="number">0xc5</span>, <span class="number">0xa3</span>, <span class="number">0xc3</span>,</span><br><span class="line">  <span class="number">0xae</span>, <span class="number">0xc3</span>, <span class="number">0xb6</span>, <span class="number">0xc3</span>, <span class="number">0xb1</span>, <span class="number">0xc3</span>, <span class="number">0xa5</span>, <span class="number">0xc4</span>,</span><br><span class="line">  <span class="number">0xbc</span>, <span class="number">0xc3</span>, <span class="number">0xae</span>, <span class="number">0xc5</span>, <span class="number">0xbe</span>, <span class="number">0xc3</span>, <span class="number">0xa5</span>, <span class="number">0xc5</span>,</span><br><span class="line">  <span class="number">0xa3</span>, <span class="number">0xc3</span>, <span class="number">0xae</span>, <span class="number">0xe1</span>, <span class="number">0xbb</span>, <span class="number">0x9d</span>, <span class="number">0xc3</span>, <span class="number">0xb1</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> funnyWord = utf8.decode(utf8Bytes);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(funnyWord == <span class="string">'Îñţérñåţîöñåļîžåţîờñ'</span>);</span><br></pre></td></tr></table></figure>

<p>将 UTF-8 字符串流转换为 Dart 字符串，为 Stream 的 <code>transform()</code> 方法上指定 <code>utf8.decoder</code>：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lines = inputStream</span><br><span class="line">    .transform(utf8.decoder)</span><br><span class="line">    .transform(LineSplitter());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">for</span> (<span class="keyword">var</span> line <span class="keyword">in</span> lines) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Got <span class="subst">$&#123;line.length&#125;</span> characters from stream'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'file is now closed'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">print</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>utf8.encode()</code> 将 Dart 字符串编码为一个 UTF8 编码的字节流：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; encoded = utf8.encode(<span class="string">'Îñţérñåţîöñåļîžåţîờñ'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(encoded.length == utf8Bytes.length);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; encoded.length; i++) &#123;</span><br><span class="line">  <span class="keyword">assert</span>(encoded[i] == utf8Bytes[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h3><p>dart:convert 库同样包含 ASCII 和 ISO-8859-1 (Latin1) 转换器。 更多详情，参考 <a href="https://api.dartlang.org/stable/dart-convert/dart-convert-library.html" target="_blank" rel="noopener">API docs for the dart:convert library。</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本页向您介绍了 Dart 内置库中最常用的功能。 但是，并没有涵盖所有内置库。 您可能想要查看的其他内容包括 <a href="https://api.dartlang.org/stable/dart-collection/dart-collection-library.html" target="_blank" rel="noopener">dart:collection</a> 和 <a href="https://api.dartlang.org/stable/dart-typed_data/dart-typed_data-library.html" target="_blank" rel="noopener">dart:typed_data,</a> ， 以及特定于平台的库，如 <a href="https://webdev.dartlang.org/guides/web-programming" target="_blank" rel="noopener">Dart web development libraries</a> 和 <a href="https://docs.flutter.io/" target="_blank" rel="noopener">Flutter libraries.</a> 。</p>
<p>您可以使用 <a href="https://www.dartcn.com/tools/pub" target="_blank" rel="noopener">pub tool</a> 工具获得更多库。 <a href="https://pub.dartlang.org/packages/collection" target="_blank" rel="noopener">collection,</a> <a href="https://pub.dartlang.org/packages/crypto" target="_blank" rel="noopener">crypto,</a> <a href="https://pub.dartlang.org/packages/http" target="_blank" rel="noopener">http,</a> <a href="https://pub.dartlang.org/packages/intl" target="_blank" rel="noopener">intl,</a> 以及 <a href="https://pub.dartlang.org/packages/test" target="_blank" rel="noopener">test</a> 以上只是简单的列举了一些可以通过 pub 安装的库。</p>
<p>要了解有关 Dart 语言的更多信息，请参考 <a href="https://www.dartcn.com/guides/language/language-tour" target="_blank" rel="noopener">language tour</a>。</p>
<p>BohuaFu整理</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Dart/" rel="tag">#Dart</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/13/dart/d-20200413-0009/" rel="next" title="Dart 異步支持">
                <i class="fa fa-chevron-left"></i> Dart 異步支持
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/04/13/dart/d-20200413-0401/" rel="prev" title="Dart -- stagehand">
                Dart -- stagehand <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://github.com/BohuaFu/AssetsBH/blob/master/bh/avater/bh_avatar_001.jpg?raw=true"
                alt="Bohua Fu" />
            
              <p class="site-author-name" itemprop="name">Bohua Fu</p>
              <p class="site-description motion-element" itemprop="description">The stars change, but the mind remains the same.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7C%20archive">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/BohuaFu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://bohuafu.github.io/" title="BH" target="_blank">BH</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Dart标准库"><span class="nav-number">1.</span> <span class="nav-text">Dart标准库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dart-库概览"><span class="nav-number">2.</span> <span class="nav-text">Dart 库概览</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dart-core-数字，集合，字符串等"><span class="nav-number">2.1.</span> <span class="nav-text">dart:core - 数字，集合，字符串等</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制台打印"><span class="nav-number">2.1.1.</span> <span class="nav-text">控制台打印</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数字"><span class="nav-number">2.1.2.</span> <span class="nav-text">数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符和正则表达式"><span class="nav-number">2.1.3.</span> <span class="nav-text">字符和正则表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在字符串中搜索"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">在字符串中搜索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#从字符串中提取数据"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">从字符串中提取数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#首字母大小写转换"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">首字母大小写转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Trimming-和空字符串"><span class="nav-number">2.1.3.4.</span> <span class="nav-text">Trimming 和空字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#替换部分字符串"><span class="nav-number">2.1.3.5.</span> <span class="nav-text">替换部分字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#构建一个字符串"><span class="nav-number">2.1.3.6.</span> <span class="nav-text">构建一个字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则表达式"><span class="nav-number">2.1.3.7.</span> <span class="nav-text">正则表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更多信息"><span class="nav-number">2.1.3.8.</span> <span class="nav-text">更多信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集合"><span class="nav-number">2.1.4.</span> <span class="nav-text">集合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Lists"><span class="nav-number">2.1.4.1.</span> <span class="nav-text">Lists</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Sets"><span class="nav-number">2.1.4.2.</span> <span class="nav-text">Sets</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Maps"><span class="nav-number">2.1.4.3.</span> <span class="nav-text">Maps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#公共集合方法"><span class="nav-number">2.1.4.4.</span> <span class="nav-text">公共集合方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URI"><span class="nav-number">2.1.5.</span> <span class="nav-text">URI</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#编码和解码完整合法的URI"><span class="nav-number">2.1.5.1.</span> <span class="nav-text">编码和解码完整合法的URI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编码和解码-URI-组件"><span class="nav-number">2.1.5.2.</span> <span class="nav-text">编码和解码 URI 组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解析-URI"><span class="nav-number">2.1.5.3.</span> <span class="nav-text">解析 URI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#构建-URI"><span class="nav-number">2.1.5.4.</span> <span class="nav-text">构建 URI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期和时间"><span class="nav-number">2.1.6.</span> <span class="nav-text">日期和时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工具类"><span class="nav-number">2.1.7.</span> <span class="nav-text">工具类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#比较对象"><span class="nav-number">2.1.7.1.</span> <span class="nav-text">比较对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Implementing-map-keys"><span class="nav-number">2.1.7.2.</span> <span class="nav-text">Implementing map keys</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代"><span class="nav-number">2.1.7.3.</span> <span class="nav-text">迭代</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常"><span class="nav-number">2.1.8.</span> <span class="nav-text">异常</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dart-async-异步编程"><span class="nav-number">2.2.</span> <span class="nav-text">dart:async - 异步编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Future"><span class="nav-number">2.2.1.</span> <span class="nav-text">Future</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用-await"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">使用 await</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基本用法"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">基本用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#链式异步编程"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">链式异步编程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#等待多个-Future"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">等待多个 Future</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stream"><span class="nav-number">2.2.2.</span> <span class="nav-text">Stream</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#异步循环"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">异步循环</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#监听流数据（stream-data）"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">监听流数据（stream data）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传递流数据（stream-data）"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">传递流数据（stream data）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理错误和完成"><span class="nav-number">2.2.2.4.</span> <span class="nav-text">处理错误和完成</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更多内容"><span class="nav-number">2.2.3.</span> <span class="nav-text">更多内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dart-math-数学和随机数"><span class="nav-number">2.3.</span> <span class="nav-text">dart:math - 数学和随机数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三角函数"><span class="nav-number">2.3.1.</span> <span class="nav-text">三角函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#最大值和最小值"><span class="nav-number">2.3.2.</span> <span class="nav-text">最大值和最小值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数学常数"><span class="nav-number">2.3.3.</span> <span class="nav-text">数学常数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#随机数"><span class="nav-number">2.3.4.</span> <span class="nav-text">随机数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更多内容-1"><span class="nav-number">2.3.5.</span> <span class="nav-text">更多内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dart-convert-编解码JSON，UTF-8等"><span class="nav-number">2.4.</span> <span class="nav-text">dart:convert - 编解码JSON，UTF-8等</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编解码JSON"><span class="nav-number">2.4.1.</span> <span class="nav-text">编解码JSON</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编解码-UTF-8-字符"><span class="nav-number">2.4.2.</span> <span class="nav-text">编解码 UTF-8 字符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他功能"><span class="nav-number">2.4.3.</span> <span class="nav-text">其他功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">2.5.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bohua Fu</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
